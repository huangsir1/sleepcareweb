<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="taiyi.web.dao.UserMapper">
	<resultMap id="BaseResultMap" type="taiyi.web.model.User">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		<id column="id" jdbcType="CHAR" property="id" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="birthday" jdbcType="DATE" property="birthday" />
		<result column="weight" jdbcType="DOUBLE" property="weight" />
		<result column="height" jdbcType="INTEGER" property="height" />
		<result column="ess_rank" jdbcType="INTEGER" property="essRank" />
		<result column="account_id" jdbcType="CHAR" property="accountId" />
		<result column="gender" jdbcType="CHAR" property="gender" />
		<result column="phone" jdbcType="VARCHAR" property="phone" />
		<result column="address" jdbcType="VARCHAR" property="address" />
		<result column="doctor_id" jdbcType="CHAR" property="doctorId" />
		<result column="register_date" jdbcType="TIMESTAMP" property="registerDate" />
		<result column="lastest_date" jdbcType="TIMESTAMP" property="lastestDate" />
	</resultMap>
	<resultMap id="userWithDH" type="taiyi.web.model.User"
		extends="BaseResultMap">
		<collection property="diseaseHistories" ofType="taiyi.web.model.DiseaseHistory">
			<id column="dh_id" property="id" jdbcType="INTEGER" />
			<result column="dh_name" property="name" jdbcType="VARCHAR" />
		</collection>
	</resultMap>

	<sql id="Base">
		u.id, u.name, u.birthday, u.weight, u.height, u.ess_rank,
		u.account_id,u.gender,u.phone, u.address, u.doctor_id,
		u.register_date, u.lastest_date
	</sql>

	<sql id="Base_Column_List">
		id, name, birthday, weight, height, ess_rank, account_id,
		gender, phone, address,
		doctor_id, register_date, lastest_date
	</sql>
	<select id="selectUserByHostipalId" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base" />
		from user u
		left join sleep_report slr on slr.user_id = u.id
		left join sub_report sr on sr.`id` = slr.`id`
		left join device d on sr.mac_address = d.mac_address
		where d.hostipal_id = #{hostipalId}
		order by u.lastest_date desc
	</select>
	<select id="selectBySysUsername" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base" />
		from user u left join sys_user su on u.doctor_id = su.id
		where
		su.username = #{username}
		order by lastest_date desc
	</select>

	<select id="selectBySysUserId" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from user where doctor_id = #{userId}
		order by lastest_date desc
	</select>

	<select id="getAllUsers" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from user order by lastest_date desc
	</select>
	<select id="selectWithDH" parameterType="java.lang.String"
		resultMap="userWithDH">
		SELECT
		<include refid="Base" />
		,dh.id as dh_id, dh.name as dh_name
		FROM user u left join
		disease_history_user dhu on u.id
		= dhu.user_id left
		join disease_history
		dh on dh.id =
		dhu.disease_history_id
		WHERE u.id = #{userId}
	</select>
	<select id="selectAllWithDH" resultMap="userWithDH">
		SELECT
		<include refid="Base" />
		,dh.id as dh_id, dh.name as dh_name
		FROM user u left join
		disease_history_user dhu on u.id
		= dhu.user_id left
		join disease_history
		dh on dh.id =
		dhu.disease_history_id
	</select>
	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		select
		<include refid="Base_Column_List" />
		from user
		where id = #{id,jdbcType=CHAR}
	</select>
	<select id="searchUsers" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from user
		where
		<if test="name != null and name != ''">
			name like #{name,jdbcType=VARCHAR} and
		</if>
		<if test="birthday != null">
			birthday like #{birthday,jdbcType=DATE} and
		</if>
		<if test="weight != null ">
			weight = #{weight,jdbcType=DOUBLE} and
		</if>
		<if test="height != null">
			height like #{height,jdbcType=INTEGER} and
		</if>
		<if test="essRank != null">
			ess_rank like #{essRank,jdbcType=INTEGER} and
		</if>
		<if test="gender != null and gender != '' ">
			gender like #{gender,jdbcType=CHAR} and
		</if>
		<if test="phone != null and phone != '' ">
			phone like #{phone,jdbcType=VARCHAR} and
		</if>
		<if test="doctorId != null and doctorId != '' ">
			doctor_id like #{doctorId,jdbcType=VARCHAR} and
		</if>
		<if test="address != null and address  != '' ">
			address like #{address,jdbcType=VARCHAR}
		</if>
		<if test="address == null or address == '' ">
			1 = 1
		</if>

	</select>

	<select id="searchUsersByPage" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from user
		where
		<if test="user.name != null and user.name != '' ">
			name like #{user.name,jdbcType=VARCHAR} and
		</if>
		<if test="user.birthday != null">
			birthday like #{user.birthday,jdbcType=DATE} and
		</if>
		<if test="user.weight != null">
			weight = #{user.weight,jdbcType=DOUBLE} and
		</if>
		<if test="user.height != null">
			height like #{user.height,jdbcType=INTEGER} and
		</if>
		<if test="user.essRank != null">
			ess_rank like #{user.essRank,jdbcType=INTEGER} and
		</if>
		<if test="user.gender != null and user.gender != '' ">
			gender like #{user.gender,jdbcType=CHAR} and
		</if>
		<if test="user.phone != null and user.phone  != '' ">
			phone like #{user.phone,jdbcType=VARCHAR} and
		</if>
		<if test="user.doctorId != null and user.doctorId != '' ">
			doctor_id like #{user.doctorId,jdbcType=VARCHAR} and
		</if>
		<if test="user.address != null and user.address != '' ">
			address like #{user.address,jdbcType=VARCHAR}
		</if>
		<if test="user.address == null or user.address  == '' ">
			1 = 1
		</if>
		limit #{current},#{pagesize}
	</select>

	<select id="searchUsersByPageCount" resultType="long">
		select
		count(*)
		from user
		where
		<if test="name != null and name != ''">
			name like #{name,jdbcType=VARCHAR} and
		</if>
		<if test="birthday != null">
			birthday like #{birthday,jdbcType=DATE} and
		</if>
		<if test="weight != null ">
			weight = #{weight,jdbcType=DOUBLE} and
		</if>
		<if test="height != null">
			height like #{height,jdbcType=INTEGER} and
		</if>
		<if test="essRank != null">
			ess_rank like #{essRank,jdbcType=INTEGER} and
		</if>
		<if test="gender != null and gender != '' ">
			gender like #{gender,jdbcType=CHAR} and
		</if>
		<if test="phone != null and phone != '' ">
			phone like #{phone,jdbcType=VARCHAR} and
		</if>
		<if test="address != null and address  != '' ">
			address like #{address,jdbcType=VARCHAR}
		</if>
		<if test="address == null or address == '' ">
			1 = 1
		</if>
	</select>


	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		delete from user
		where id = #{id,jdbcType=CHAR}
	</delete>
	<insert id="insert" parameterType="taiyi.web.model.User">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		insert into user (id, name, birthday,
		weight, height, ess_rank,
		account_id, gender, phone,
		address, doctor_id, register_date,
		lastest_date)
		values (#{id,jdbcType=CHAR}, #{name,jdbcType=VARCHAR},
		#{birthday,jdbcType=DATE},
		#{weight,jdbcType=DOUBLE},
		#{height,jdbcType=INTEGER}, #{essRank,jdbcType=INTEGER},
		#{accountId,jdbcType=CHAR}, #{gender,jdbcType=CHAR},
		#{phone,jdbcType=VARCHAR},
		#{address,jdbcType=VARCHAR},
		#{doctorId,jdbcType=CHAR}, #{registerDate,jdbcType=TIMESTAMP},
		#{lastestDate,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="taiyi.web.model.User">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		insert into user
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="birthday != null">
				birthday,
			</if>
			<if test="weight != null">
				weight,
			</if>
			<if test="height != null">
				height,
			</if>
			<if test="essRank != null">
				ess_rank,
			</if>
			<if test="accountId != null">
				account_id,
			</if>
			<if test="gender != null">
				gender,
			</if>
			<if test="phone != null">
				phone,
			</if>
			<if test="address != null">
				address,
			</if>
			<if test="doctorId != null">
				doctor_id,
			</if>
			<if test="registerDate != null">
				register_date,
			</if>
			<if test="lastestDate != null">
				lastest_date,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=CHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				#{birthday,jdbcType=DATE},
			</if>
			<if test="weight != null">
				#{weight,jdbcType=DOUBLE},
			</if>
			<if test="height != null">
				#{height,jdbcType=INTEGER},
			</if>
			<if test="essRank != null">
				#{essRank,jdbcType=INTEGER},
			</if>
			<if test="accountId != null">
				#{accountId,jdbcType=CHAR},
			</if>
			<if test="gender != null">
				#{gender,jdbcType=CHAR},
			</if>
			<if test="phone != null">
				#{phone,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				#{address,jdbcType=VARCHAR},
			</if>
			<if test="doctorId != null">
				#{doctorId,jdbcType=CHAR},
			</if>
			<if test="registerDate != null">
				#{registerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastestDate != null">
				#{lastestDate,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="taiyi.web.model.User">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		update user
		<set>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				birthday = #{birthday,jdbcType=DATE},
			</if>
			<if test="weight != null">
				weight = #{weight,jdbcType=DOUBLE},
			</if>
			<if test="height != null">
				height = #{height,jdbcType=INTEGER},
			</if>
			<if test="essRank != null">
				ess_rank = #{essRank,jdbcType=INTEGER},
			</if>
			<if test="accountId != null">
				account_id = #{accountId,jdbcType=CHAR},
			</if>
			<if test="gender != null">
				gender = #{gender,jdbcType=CHAR},
			</if>
			<if test="phone != null">
				phone = #{phone,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="doctorId != null">
				doctor_id = #{doctorId,jdbcType=CHAR},
			</if>
			<if test="registerDate != null">
				register_date = #{registerDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastestDate != null">
				lastest_date = #{lastestDate,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=CHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="taiyi.web.model.User">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jun 02 
			15:08:20 CST 2016. -->
		update user
		set name = #{name,jdbcType=VARCHAR},
		birthday =
		#{birthday,jdbcType=DATE},
		weight = #{weight,jdbcType=DOUBLE},
		height =
		#{height,jdbcType=INTEGER},
		ess_rank = #{essRank,jdbcType=INTEGER},
		account_id = #{accountId,jdbcType=CHAR},
		gender =
		#{gender,jdbcType=CHAR},
		phone = #{phone,jdbcType=VARCHAR},
		address =
		#{address,jdbcType=VARCHAR},
		doctor_id = #{doctorId,jdbcType=CHAR},
		register_date = #{registerDate,jdbcType=TIMESTAMP},
		lastest_date =
		#{lastestDate,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=CHAR}
	</update>
</mapper>